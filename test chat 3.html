<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Multi-Problem Python Grader</title>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/brython@3.9.5/brython.min.js"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/brython@3.9.5/brython_stdlib.js"></script>
  <style>
    textarea, select, pre {
      width: 100%;
      font-family: monospace;
      margin-top: 10px;
    }
    button {
      margin-top: 10px;
    }
    .result {
      background: #f2f2f2;
      padding: 10px;
      margin-top: 10px;
      white-space: pre-wrap;
    }
  </style>
</head>
<body onload="brython()">
  <h1>Python Grader (Multiple Problems)</h1>

  <label for="problem">Select Problem:</label><br>
  <select id="problem">
    <option value="plustwo">EX1. Sum of Two Numbers</option>
    <option value="balance">EX2. Balance</option>
    <option value="oddeven">1. Odd or Even</option>
    <option value="bigger">2. Who is Bigger</option>
    <option value="vat">3. VAT7</option>
    <option value="fever">4. I have a fever</option>
    <option value="legal">5. Legal or not</option>
    <option value="zero">6. Is 0 a plus or a minus</option>
    <option value="tri">7. Area of triangle</option>
    <option value="quad">8. Triangle and Quadrangle</option>
    <option value="multiple">9. Multiple or Plus</option>
    <option value="pay">10. Overtime Pay</option>
  </select>

  <div id="problem-description" style="margin-top: 10px; padding: 8px; background: #eef; border-left: 4px solid #888;"></div>

  <label for="code">Student Code:</label><br>
  <textarea id="code" rows="6"></textarea><br>

  <button onclick="runCode()">Run & Evaluate</button>
  <button onclick="downloadCSV()">üì• Download CSV</button>

  <div class="result" id="output">Output will appear here...</div>

  <script type="text/python">
from browser import document, html, window
import traceback
import sys
from io import StringIO
import re

results_data = []

test_banks = {
    "plustwo": {
        "name": "EX1. Sum of Two Numbers",
        "description": "‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç 2 ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏£‡∏ß‡∏°‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á/n/nInput:/n5/n7/nOutput:/n12",
        "cases": [
            {"input": ["3", "5"], "output": "8"},
            {"input": ["10", "15"], "output": "25"},
            {"input": ["0", "0"], "output": "0"}
        ]
    },
    "balance": {
        "name": "EX2. Balance",
        "description": "‡∏£‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ï‡πá‡∏°‡∏°‡∏≤ 1 ‡∏Ñ‡πà‡∏≤‡πÅ‡∏•‡πâ‡∏ß output ‡∏ñ‡πâ‡∏≤‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 5 ‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤ Too Much ‡∏ñ‡πâ‡∏≤‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤ 5 ‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤ Not Enough ‡∏ñ‡πâ‡∏≤‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö 5 ‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤ Balance",
        "cases": [
            {"input": ["10"], "output": "too much"},
            {"input": ["5"], "output": "balance"},
            {"input": ["0"], "output": "not enough"}
        ]
    },
    "oddeven": {
        "name": "1. Odd or Even",
        "description": "‡πÉ‡∏´‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏•‡∏Ç‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ï‡πá‡∏°‡∏ô‡∏±‡πâ‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏π‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏µ‡πà/n/nInput:/n5/nOutput:/nOdd",
        "cases": [
            {"input": ["1"], "output": "Odd"},
            {"input": ["23"], "output": "Odd"},
            {"input": ["100"], "output": "Even"}
        ]
    },
    "bigger": {
        "name": "2. Who is Bigger",
        "description": "‡∏£‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ï‡πá‡∏°‡∏°‡∏≤ 2 ‡∏Ñ‡πà‡∏≤‡πÅ‡∏•‡πâ‡∏ß output ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ß‡πà‡∏≤‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÉ‡∏î‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ ‡∏ñ‡πâ‡∏≤‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô‡πÉ‡∏´‡πâ‡∏ö‡∏≠‡∏Å‡∏ß‡πà‡∏≤‡∏Ñ‡πà‡∏≤‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô/n/nInput:/n2/n7/nOutput:/n7/n/nInput:/n2/n2/nOutput:/nEqual",
        "cases": [
            {"input": ["5", "4"], "output": "5"},
            {"input": ["6", "6"], "output": "Equal"},
            {"input": ["0", "8"], "output": "8"}
        ]
    },
    "vat": {
        "name": "3. VAT7",
        "description": "‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≤‡∏Ñ‡∏≤‡πÇ‡∏î‡∏¢‡∏£‡∏ß‡∏°‡∏†‡∏≤‡∏©‡∏µ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏° 7%/n/nInput:/n100/nOutput:/n107.0",
        "cases": [
            {"input": ["550"], "output": "588.5"},
            {"input": ["100"], "output": "107.0"},
            {"input": ["0"], "output": "0.0"}
        ]
    },
    "fever": {
        "name": "4. I have a fever",
        "description": "‡πÉ‡∏´‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏•‡∏Ç‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà 37.5 ‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏Ç‡πâ/n/nInput:/n27/nOutput:/nHealthy/n/nInput:/n42/nOutput:/nFever",
        "cases": [
            {"input": ["0"], "output": "Healthy"},
            {"input": ["100"], "output": "Fever"},
            {"input": ["37.5"], "output": "Fever"}
        ]
    },
    "legal": {
        "name": "5. Legal or not",
        "description": "‡∏£‡∏±‡∏ö‡∏≠‡∏≤‡∏¢‡∏∏ ‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤‡∏≠‡∏≤‡∏¢‡∏∏‡∏ô‡∏±‡πâ‡∏ô‡∏ö‡∏£‡∏£‡∏•‡∏∏‡∏ô‡∏¥‡∏ï‡∏¥‡∏†‡∏≤‡∏ß‡∏∞‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà (20 ‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤‡∏ö‡∏£‡∏£‡∏•‡∏∏)/n/nInput:/n2/nOutput:/n2,Illegal/n/nInput:/n50/nOutput:/n50,Legal",
        "cases": [
            {"input": ["25"], "output": "25,Legal"},
            {"input": ["20"], "output": "20,Legal"},
            {"input": ["10"], "output": "10,Illegal"}
        ]
    },
    "zero": {
        "name": "6. Is 0 a plus or a minus",
        "description": "‡∏£‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ï‡πá‡∏° ‡πÅ‡∏•‡πâ‡∏ß‡∏ö‡∏≠‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ö‡∏ß‡∏Å ‡∏•‡∏ö ‡∏´‡∏£‡∏∑‡∏≠ ‡∏®‡∏π‡∏ô‡∏¢‡πå/nOutput:/n+,-,0",
        "cases": [
            {"input": ["6"], "output": "+"},
            {"input": ["-5"], "output": "-"},
            {"input": ["0"], "output": "0"}
        ]
    },
    "tri": {
        "name": "7. Area of triangle",
        "description": "‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡πÅ‡∏•‡∏∞‡∏ê‡∏≤‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡πÄ‡∏´‡∏•‡∏µ‡πà‡∏¢‡∏°/n/nInput:/n5/n10/nOutput:/n25",
        "cases": [
            {"input": ["10", "50"], "output": "250"},
            {"input": ["100", "0"], "output": "0"},
            {"input": ["0", "0"], "output": "0"}
        ]
    },
    "quad": {
        "name": "8. Triangle and Quadrangle",
        "description": "‡∏£‡∏±‡∏ö t ‡∏´‡∏£‡∏∑‡∏≠ q ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡πÄ‡∏´‡∏•‡∏µ‡πà‡∏¢‡∏°‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏µ‡πà‡∏¢‡∏° ‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á/n/nInput:/nt/n5/n6/nOutput:/n15",
        "cases": [
            {"input": ["t", "3", "100"], "output": "150"},
            {"input": ["q", "5", "100"], "output": "500"},
            {"input": ["a", "10", "5"], "output": "no"}
        ]
    },
    "multiple": {
        "name": "9. Multiple or Plus",
        "description": "‡∏£‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ï‡πá‡∏° 2 ‡∏Ñ‡πà‡∏≤ ‡πÅ‡∏•‡πâ‡∏ß‡∏ö‡∏≠‡∏Å‡∏ß‡πà‡∏≤‡∏ú‡∏•‡∏ö‡∏ß‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡∏ú‡∏•‡∏Ñ‡∏π‡∏ì‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏Å‡∏±‡∏ô/n/nInput:/n5/n7/nOutput:/nMultiple/n/nInput:/n2/n0/nOutput:/nPlus",
        "cases": [
            {"input": ["10", "5"], "output": "Multiple"},
            {"input": ["1", "5"], "output": "Plus"},
            {"input": ["7", "0"], "output": "Plus"}
        ]
    },
    "pay": {
        "name": "10. Overtime Pay",
        "description": "‡∏Ñ‡∏¥‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡πà‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏•‡∏∞ 100 ‡∏ö‡∏≤‡∏ó ‡πÄ‡∏Å‡∏¥‡∏ô 8 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏Ñ‡∏¥‡∏î 200 ‡∏ö‡∏≤‡∏ó‡∏ï‡πà‡∏≠‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á/n/nInput:/n14/nOutput:/n2000",
        "cases": [
            {"input": ["5"], "output": "500"},
            {"input": ["10"], "output": "1200"},
            {"input": ["8"], "output": "800"}
        ]
    }
}

def replace_inputs(code, inputs):
    pattern = r"input\s*\(\s*\)"
    return re.sub(pattern, lambda m: f"'{inputs.pop(0)}'", code)

def runCode():
    selected = document["problem"].value
    test_cases = test_banks[selected]["cases"]
    original_code = document["code"].value
    output_div = document["output"]
    output_text = f"Selected Problem: {test_banks[selected]['name']}\n\n"

    for test in test_cases:
        inputs = test["input"].copy()
        expected = test["output"]
        code_to_run = replace_inputs(original_code, inputs)

        sys_stdout_backup = sys.stdout
        output_io = StringIO()
        sys.stdout = output_io

        try:
            exec(code_to_run, {"__name__": "__main__"})
            student_output = output_io.getvalue().strip()
        except Exception:
            student_output = f"Error: {traceback.format_exc(limit=1)}"
        finally:
            sys.stdout = sys_stdout_backup

        correct = student_output == expected
        results_data.append({
            "problem": test_banks[selected]["name"],
            "input": test["input"],
            "expected": expected,
            "student_output": student_output,
            "correct": correct
        })

        output_text += f"Input: {test['input']} | Expected: {expected} | Got: {student_output} ‚Üí {'‚úÖ' if correct else '‚ùå'}\n"

    output_div.text = output_text

window.runCode = runCode

def downloadCSV():
    if not results_data:
        window.alert("‚õî ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô")
        return

    csv = "Problem,Input,Expected,Student Output,Result\n"
    for r in results_data:
        line = f"{r['problem']}," \
               f"{'|'.join(r['input'])}," \
               f"{r['expected']}," \
               f"{r['student_output']}," \
               f"{'Correct' if r['correct'] else 'Incorrect'}"
        csv += line + "\n"

    blob = window.Blob.new([csv], { "type": "text/csv" })
    url = window.URL.createObjectURL(blob)
    link = document.createElement("a")
    link.href = url
    link.download = "grading_results.csv"
    document <= link
    link.click()
    link.remove()

window.downloadCSV = downloadCSV

def on_problem_change(event):
    key = document["problem"].value
    description = test_banks[key]["description"].replace("/n", "<br>")
    document["problem-description"].html = description
    document["code"].value = ""
    document["output"].text = "Output will appear here..."

document["problem"].bind("change", on_problem_change)
on_problem_change(None)
  </script>
</body>
</html>
